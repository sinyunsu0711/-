<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…¸ë ¥ ë„¤íŠ¸ì›Œí¬ ìµœë‹¨ ê²½ë¡œ ì‹œë®¬ë ˆì´í„° (Dijkstra)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .code-output {
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        /* SVG ë…¸ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .node {
            fill: #ef4444; /* red-500 (ì¹œêµ¬ ë…¸ë“œ) */
            transition: all 0.3s ease-in-out;
        }
        /* SVG ë§í¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .link {
            stroke: #9ca3af; /* gray-400 */
            stroke-width: 2;
            transition: stroke 0.3s ease-in-out, stroke-width 0.3s ease-in-out;
        }
        /* ì‹œê°í™”ìš© ìŠ¤íƒ€ì¼ */
        .node-current { fill: #facc15; } /* yellow-400 */
        .link-relaxed { stroke: #10b981; stroke-width: 4; } /* emerald-500 (ê±°ë¦¬ ê°±ì‹ ) */
        .path-final { stroke: #3b82f6; stroke-width: 5; } /* blue-500 (ìµœì¢… ê²½ë¡œ) */
        .node-final { fill: #3b82f6; } /* blue-500 */
        
        .weight-input {
            width: 4rem; 
            padding: 0.2rem; 
            text-align: center;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: border-color 0.15s;
        }
        .weight-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-10">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 border-b-4 border-red-500 pb-2">
            ğŸ¤ ë…¸ë ¥ ë„¤íŠ¸ì›Œí¬ ìµœë‹¨ ê²½ë¡œ ì‹œë®¬ë ˆì´í„°
        </h1>
        <p class="text-gray-500 mb-6">
            ì´ ì‹œë®¬ë ˆì´í„°ëŠ” **ê°€ì¥ ì ì€ 'ë…¸ë ¥'ì´ë‚˜ 'ì‹œê°„'**ì„ ë“¤ì—¬ ëª¨ë“  ì¹œêµ¬ì—ê²Œ ë„ë‹¬í•˜ëŠ” ê²½ë¡œë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤. 
        </p>

        <!-- ë„¤íŠ¸ì›Œí¬ ì§€ë„ ë° ì‹œê°í™” ì˜ì—­ -->
        <div class="bg-red-50 p-5 rounded-xl shadow-inner mb-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- ì‹œê°í™” ì˜ì—­ -->
            <div>
                <h2 class="text-xl font-semibold text-red-700 mb-4">ğŸ—ºï¸ ì¹œêµ¬ ê´€ê³„ ì§€ë„ (ì‹¤ì‹œê°„ íƒìƒ‰)</h2>
                <div class="p-3 bg-white rounded-lg border border-red-200 shadow-md">
                    <svg id="networkSVG" width="100%" height="300" viewBox="0 0 500 300" class="w-full"></svg>
                </div>
                <p class="text-xs text-gray-500 mt-2">
                    <span class="text-red-500 font-bold">ì›</span>: ì¹œêµ¬ (ë…¸ë“œ), <span class="text-gray-600 font-bold">ì„ </span>: ê´€ê³„ (ë§í¬), <span class="text-gray-600 font-bold">ìˆ«ì</span>: ì—°ê²° ìœ ì§€ ë…¸ë ¥(ê°€ì¤‘ì¹˜)
                </p>
            </div>

            <!-- ê°€ì¤‘ì¹˜ ì„¤ì • ì˜ì—­ -->
            <div>
                <h2 class="text-xl font-semibold text-red-700 mb-4">âœï¸ ê´€ê³„ ë…¸ë ¥(ê°€ì¤‘ì¹˜) ì„¤ì •</h2>
                <p class="text-gray-700 mb-3">ê° ì—°ê²°ì— ë“œëŠ” ë…¸ë ¥(ì‹œê°„/ë¹„ìš©)ì„ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”. (ìˆ«ìê°€ ë‚®ì„ìˆ˜ë¡ ì¹œë°€í•˜ê±°ë‚˜ ê°€ê¸° ì‰¬ìš´ ê¸¸)</p>
                <div id="networkMap" class="p-3 bg-white rounded-lg border border-red-200 grid grid-cols-2 gap-x-4 gap-y-2 code-output text-gray-900 h-40 overflow-y-auto">
                    <!-- Input fields will be dynamically populated by JS -->
                </div>
            </div>
        </div>


        <!-- ì„¤ì • ë° ì‹¤í–‰ ì˜ì—­ -->
        <div class="bg-indigo-50 p-5 rounded-xl shadow-inner mb-8">
            <h2 class="text-xl font-semibold text-indigo-700 mb-4">ì‹œë®¬ë ˆì´ì…˜ ì„¤ì • ë° ì‹¤í–‰</h2>
            <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                <label for="startRouter" class="text-gray-700 font-medium whitespace-nowrap">
                    ì¶œë°œ ì¹œêµ¬ (ë‚˜) ì„ íƒ:
                </label>
                <select id="startRouter" class="p-2 border border-indigo-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 flex-grow">
                    <!-- Options populated by JavaScript -->
                </select>
                <button onclick="runSimulationUI()" id="runButton" class="w-full sm:w-auto px-6 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                    ìµœë‹¨ ë…¸ë ¥ ê²½ë¡œ íƒìƒ‰
                </button>
            </div>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        <div id="resultsContainer" class="space-y-8">
            <!-- ì‹œë®¬ë ˆì´ì…˜ ë¡œê·¸ -->
            <div class="border-2 border-gray-200 rounded-xl p-4">
                <h2 class="text-xl font-semibold text-gray-800 mb-3">ğŸ” íƒìƒ‰ ë¡œê·¸: ìµœì†Œ ë…¸ë ¥ ê²½ë¡œ ì°¾ëŠ” ê³¼ì •</h2>
                <div id="logOutput" class="bg-gray-800 text-green-400 p-3 rounded-lg code-output h-64 overflow-y-auto">
                    ì‹¤í–‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.
                </div>
                <p class="text-xs text-gray-500 mt-2">
                    **[íƒìƒ‰]** ë…¸ë€ìƒ‰ìœ¼ë¡œ ë°˜ì§ì´ëŠ” ì¹œêµ¬ë¥¼ ê²½ìœ í•  ë•Œ, **[ê±°ë¦¬ ê°±ì‹ ]**ì€ ì²­ë¡ìƒ‰ ì„ ìœ¼ë¡œ ë” ì ì€ ë…¸ë ¥ì´ ë“œëŠ” ìƒˆë¡œìš´ ê²½ë¡œë¥¼ ì°¾ì•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
                </p>
            </div>

            <!-- ìµœì¢… ë¼ìš°íŒ… í…Œì´ë¸” -->
            <div class="border-2 border-gray-200 rounded-xl p-4">
                <h2 class="text-xl font-semibold text-gray-800 mb-3">ğŸ“Š ìµœì¢… ìµœì†Œ ë…¸ë ¥ í…Œì´ë¸” (ê´€ê³„ ì •ë¦¬í‘œ)</h2>
                <div id="tableOutput" class="overflow-x-auto">
                    <!-- Table will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë„¤íŠ¸ì›Œí¬ì˜ êµ¬ì¡° (ë…¸ë“œì™€ ë§í¬) ë° ì´ˆê¸° ê°€ì¤‘ì¹˜ ì •ì˜
        const INITIAL_LINKS = [
            { u: 'A', v: 'B', cost: 5 }, { u: 'A', v: 'C', cost: 1 },
            { u: 'B', v: 'C', cost: 2 }, { u: 'B', v: 'D', cost: 3 },
            { u: 'C', v: 'E', cost: 10 }, { u: 'C', v: 'F', cost: 8 },
            { u: 'D', v: 'F', cost: 1 },
            { u: 'E', v: 'F', cost: 4 }
        ];

        // SVG ì‹œê°í™”ë¥¼ ìœ„í•œ ë…¸ë“œ ìœ„ì¹˜ ì •ì˜ (x, y ì¢Œí‘œ)
        const NODE_POSITIONS = {
            'A': {x: 50, y: 150},
            'B': {x: 200, y: 50},
            'C': {x: 200, y: 250},
            'D': {x: 350, y: 50},
            'E': {x: 450, y: 200},
            'F': {x: 350, y: 150}
        };

        const NODE_RADIUS = 15;
        const STEP_DELAY = 600; 
        let visualizationSteps = []; 
        let isVisualizing = false;

        const logOutput = document.getElementById('logOutput');
        const tableOutput = document.getElementById('tableOutput');
        const startRouterSelect = document.getElementById('startRouter');
        const networkMap = document.getElementById('networkMap');
        const svgContainer = document.getElementById('networkSVG');
        const runButton = document.getElementById('runButton');
        let currentGraph = {}; // í˜„ì¬ UI ê°€ì¤‘ì¹˜ë¥¼ ë°˜ì˜í•œ ê·¸ë˜í”„

        // ------------------ í—¬í¼ í•¨ìˆ˜ ------------------

        /**
         * SVG IDë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ë…¸ë“œ: n-A, ë§í¬: l-A-B)
         */
        function getElementId(type, node1, node2) {
            if (type === 'node') return `n-${node1}`;
            if (type === 'dist') return `d-${node1}`;
            if (type === 'input') return `input-${node1}-${node2}`;
            // ë§í¬ IDëŠ” ì•ŒíŒŒë²³ ìˆœì„œë¡œ í†µì¼
            const [u, v] = [node1, node2].sort();
            return `l-${u}-${v}`;
        }

        /**
         * ë¡œê·¸ë¥¼ UIì— ì¶”ê°€í•˜ê³  ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.
         */
        function appendLog(message) {
            logOutput.innerHTML += message + '\n';
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        /**
         * ìµœë‹¨ ê²½ë¡œë¥¼ ì¬êµ¬ì„±í•©ë‹ˆë‹¤.
         */
        function reconstructPath(previousNodes, startNode, targetNode) {
            let path = [];
            let current = targetNode;
            
            while (current !== null) {
                path.push(current);
                current = previousNodes[current];
                
                if (current === startNode) {
                    path.push(startNode);
                    break;
                }
                if (current === undefined && path.length > 0 && path[path.length - 1] !== startNode) {
                    return "ê²½ë¡œ ì—†ìŒ";
                }
            }
            
            return path.reverse().join(" â†’ ");
        }

        /**
         * UIì˜ ì…ë ¥ê°’ì„ ì½ì–´ ìƒˆë¡œìš´ ê·¸ë˜í”„ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
         */
        function getCustomGraph() {
            const graph = {};
            const nodes = Object.keys(NODE_POSITIONS);
            for (const node of nodes) {
                graph[node] = {};
            }

            let allWeightsValid = true;

            INITIAL_LINKS.forEach(link => {
                const [u, v] = [link.u, link.v].sort();
                const inputId = getElementId('input', u, v); // ì •ë ¬ëœ ID ì‚¬ìš©
                const inputEl = document.getElementById(inputId);
                let weight;
                
                // ì…ë ¥ í•„ë“œê°€ ì—†ê±°ë‚˜ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìœ¼ë©´ ê±´ë„ˆëœë‹ˆë‹¤.
                if (!inputEl) {
                    weight = link.cost; 
                } else {
                    weight = parseInt(inputEl.value, 10);
                }

                if (isNaN(weight) || weight <= 0 || weight > 999) {
                    // ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ ì²˜ë¦¬
                    weight = link.cost; // ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
                    if (inputEl) inputEl.value = weight; // UIë„ ë³µì›
                    allWeightsValid = false;
                }

                // ê°€ì¤‘ì¹˜ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì ìš©
                graph[link.u][link.v] = weight;
                graph[link.v][link.u] = weight;
            });

            if (!allWeightsValid) {
                appendLog(`[ê²½ê³ ] ì˜ëª»ëœ ë¹„ìš©(0 ì´í•˜ ë˜ëŠ” ë„ˆë¬´ í° ê°’)ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }

            return graph;
        }
        
        // ------------------ SVG ì‹œê°í™” ------------------

        /**
         * SVGì— ë„¤íŠ¸ì›Œí¬ ê·¸ë˜í”„ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ê·¸ë¦½ë‹ˆë‹¤.
         */
        function drawNetwork(graph) {
            svgContainer.innerHTML = '';
            
            const linksGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const nodesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const textGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');

            // 1. ë§í¬ (Lines) ê·¸ë¦¬ê¸°
            const drawnLinks = new Set();
            for (const node1 in graph) {
                for (const node2 in graph[node1]) {
                    // ì¤‘ë³µ ë§í¬ ë°©ì§€ (A-Bì™€ B-A)
                    const linkId = getElementId('link', node1, node2);
                    if (drawnLinks.has(linkId)) continue;
                    drawnLinks.add(linkId);

                    const pos1 = NODE_POSITIONS[node1];
                    const pos2 = NODE_POSITIONS[node2];
                    const cost = graph[node1][node2];

                    // Link Line
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('id', linkId);
                    line.setAttribute('x1', pos1.x);
                    line.setAttribute('y1', pos1.y);
                    line.setAttribute('x2', pos2.x);
                    line.setAttribute('y2', pos2.y);
                    line.setAttribute('class', 'link');
                    linksGroup.appendChild(line);

                    // Cost Text (Link ê°€ì¤‘ì¹˜)
                    const costText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    costText.setAttribute('x', (pos1.x + pos2.x) / 2);
                    costText.setAttribute('y', (pos1.y + pos2.y) / 2 - 5);
                    costText.textContent = cost;
                    costText.setAttribute('fill', '#4b5563'); // gray-600
                    costText.setAttribute('font-size', '12');
                    costText.setAttribute('font-weight', 'bold');
                    costText.setAttribute('text-anchor', 'middle');
                    textGroup.appendChild(costText);
                }
            }

            // 2. ë…¸ë“œ (Circles) ë° í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
            const startNode = startRouterSelect.value;
            for (const node in NODE_POSITIONS) {
                const pos = NODE_POSITIONS[node];

                // Node Circle
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('id', getElementId('node', node));
                circle.setAttribute('cx', pos.x);
                circle.setAttribute('cy', pos.y);
                circle.setAttribute('r', NODE_RADIUS);
                circle.setAttribute('class', 'node');
                nodesGroup.appendChild(circle);

                // Node Label (A, B, C...)
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', pos.x);
                label.setAttribute('y', pos.y + 5);
                label.textContent = node;
                label.setAttribute('fill', 'white');
                label.setAttribute('font-size', '14');
                label.setAttribute('font-weight', 'bold');
                label.setAttribute('text-anchor', 'middle');
                nodesGroup.appendChild(label);

                // Distance Text (d-A, d-B...)
                const distText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                distText.setAttribute('id', getElementId('dist', node));
                distText.setAttribute('x', pos.x);
                distText.setAttribute('y', pos.y + 30);
                distText.textContent = node === startNode ? '0' : 'âˆ';
                distText.setAttribute('fill', '#1f2937'); // gray-800
                distText.setAttribute('font-size', '12');
                distText.setAttribute('font-weight', 'bold');
                distText.setAttribute('text-anchor', 'middle');
                textGroup.appendChild(distText);
            }
            
            svgContainer.appendChild(linksGroup);
            svgContainer.appendChild(nodesGroup);
            svgContainer.appendChild(textGroup);
        }

        /**
         * ì‹œê°í™” ë‹¨ê³„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
         */
        function visualizeSteps(steps, finalPaths) {
            if (steps.length === 0) {
                finalPathVisualization(finalPaths);
                runButton.disabled = false;
                runButton.textContent = 'ìµœë‹¨ ë…¸ë ¥ ê²½ë¡œ íƒìƒ‰';
                isVisualizing = false;
                return;
            }

            const step = steps.shift();
            
            // ëª¨ë“  ë…¸ë“œ/ë§í¬ ì´ˆê¸°í™” (ì´ì „ ë‹¨ê³„ì˜ ì„ì‹œ í•˜ì´ë¼ì´íŠ¸ í•´ì œ)
            document.querySelectorAll('.node-current, .link-relaxed').forEach(el => {
                el.classList.remove('node-current', 'link-relaxed');
            });
            
            if (step.type === 'select') {
                // 1. í˜„ì¬ ë…¸ë“œ ì„ íƒ ì‹œ ì‹œê°í™” ë° ë¡œê·¸ ì¶œë ¥
                const nodeEl = document.getElementById(getElementId('node', step.node));
                nodeEl.classList.add('node-current');
                appendLog(`\n[íƒìƒ‰] í˜„ì¬ í™•ì •í•œ ìµœì†Œ ë…¸ë ¥ ì§€ì : ${step.node} (ëˆ„ì  ë…¸ë ¥: ${step.currentDist})`);

            } else if (step.type === 'relax') {
                // 2. ê±°ë¦¬ ê°±ì‹ (Relaxation) ì‹œ ì‹œê°í™” ë° ë¡œê·¸ ì¶œë ¥
                const linkEl = document.getElementById(getElementId('link', step.from, step.to));
                const neighborEl = document.getElementById(getElementId('node', step.to));
                const distTextEl = document.getElementById(getElementId('dist', step.to));

                // ë§í¬ì™€ ì´ì›ƒ ë…¸ë“œë¥¼ ê°•ì¡°
                linkEl.classList.add('link-relaxed');
                neighborEl.classList.add('node-current');
                
                // ê±°ë¦¬ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                distTextEl.textContent = step.newDist;

                appendLog(`  - ì´ì›ƒ ì¹œêµ¬ '${step.to}': ë” ì ì€ ë…¸ë ¥ ê²½ë¡œ ë°œê²¬! (ìƒˆ ëˆ„ì  ë…¸ë ¥: ${step.newDist})`);
            } else if (step.type === 'final') {
                // 3. ë…¸ë“œ í™•ì •
                const nodeEl = document.getElementById(getElementId('node', step.node));
                nodeEl.classList.add('node-final');
            }

            // ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìœ„í•œ ì¬ê·€ í˜¸ì¶œ
            setTimeout(() => visualizeSteps(steps, finalPaths), STEP_DELAY);
        }

        /**
         * ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ í›„ ìµœì¢… ê²½ë¡œë¥¼ SVGì— ê·¸ë¦½ë‹ˆë‹¤.
         */
        function finalPathVisualization(finalPaths) {
            // ëª¨ë“  ë§í¬ ì´ˆê¸°í™” (ìµœì¢… ê²½ë¡œë§Œ ë‚¨ê¸°ê¸°)
            document.querySelectorAll('.link').forEach(el => {
                 el.classList.remove('link-relaxed');
                 el.classList.remove('path-final');
                 el.style.stroke = '#9ca3af'; // ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ë³µì›
                 el.style.strokeWidth = '2'; // ê¸°ë³¸ ë‘ê»˜ë¡œ ë³µì›
            });
            
            const startNode = startRouterSelect.value;

            // ìµœì¢… ê²½ë¡œ ë§í¬ í•˜ì´ë¼ì´íŠ¸
            for (const targetNode in finalPaths) {
                if (targetNode === startNode) continue;

                let current = targetNode;
                while (current !== startNode && finalPaths[current] !== null) {
                    const next = finalPaths[current];
                    const linkId = getElementId('link', current, next);
                    
                    const linkEl = document.getElementById(linkId);
                    if (linkEl) {
                        linkEl.classList.add('path-final');
                        linkEl.style.stroke = '#3b82f6';
                        linkEl.style.strokeWidth = '4';
                    }
                    current = next;
                }
            }

            // ëª¨ë“  ë…¸ë“œë¥¼ ìµœì¢… ìƒ‰ìƒìœ¼ë¡œ
            document.querySelectorAll('.node').forEach(el => {
                el.classList.remove('node-current');
                el.classList.add('node-final');
            });
        }


        // ------------------ ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜ (JS & ì‹œê°í™” í†µí•©) ------------------

        /**
         * ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰ (ì‹œê°í™” ë‹¨ê³„ë¥¼ ê¸°ë¡)
         */
        function dijkstraShortestPath(graph, startNode) {
            logOutput.innerHTML = '';
            visualizationSteps = [];
            
            appendLog(`--- ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘: ì¶œë°œ ì¹œêµ¬ '${startNode}'ì—ì„œ ìµœì†Œ ë…¸ë ¥ ê²½ë¡œ ì°¾ê¸° ---`);

            const nodes = Object.keys(graph);
            let distances = {};
            let previousNodes = {};
            
            let unvisited = [...nodes]; 

            // 1. ì´ˆê¸°í™”
            nodes.forEach(node => {
                distances[node] = Infinity;
                previousNodes[node] = null;
            });
            distances[startNode] = 0;

            // ì´ˆê¸° ê±°ë¦¬ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById(getElementId('dist', startNode)).textContent = 0;

            while (unvisited.length > 0) {
                // 2. ë¯¸ë°©ë¬¸ ë…¸ë“œ ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ë…¸ë“œë¥¼ ì„ íƒ
                let current = unvisited.reduce((minNode, node) => {
                    if (distances[node] < distances[minNode]) return node;
                    return minNode;
                }, unvisited[0]);
                
                let currentDistance = distances[current];

                if (currentDistance === Infinity) break;

                // 3. í˜„ì¬ ë…¸ë“œë¥¼ unvisited ëª©ë¡ì—ì„œ ì œê±° (ë°©ë¬¸ ì²˜ë¦¬)
                unvisited = unvisited.filter(node => node !== current);
                
                // ì‹œê°í™” ë‹¨ê³„ ê¸°ë¡ (ë…¸ë“œ ì„ íƒ)
                visualizationSteps.push({ type: 'select', node: current, currentDist: currentDistance });
                
                // 4. ì¸ì ‘ ë…¸ë“œë“¤ì„ í™•ì¸í•˜ì—¬ ê±°ë¦¬ ê°±ì‹  (Relaxation)
                for (const neighbor in graph[current]) {
                    const weight = graph[current][neighbor];
                    const distance = currentDistance + weight;

                    // ìƒˆë¡œìš´ ê²½ë¡œê°€ ê¸°ì¡´ ê²½ë¡œë³´ë‹¤ ì§§ìœ¼ë©´ ê°±ì‹ 
                    if (distance < distances[neighbor]) {
                        distances[neighbor] = distance;
                        previousNodes[neighbor] = current;

                        // ì‹œê°í™” ë‹¨ê³„ ê¸°ë¡ (ê±°ë¦¬ ê°±ì‹ )
                        visualizationSteps.push({ 
                            type: 'relax', 
                            from: current, 
                            to: neighbor, 
                            newDist: distance 
                        });
                    }
                }
                
                // ì‹œê°í™” ë‹¨ê³„ ê¸°ë¡ (ë…¸ë“œ í™•ì •)
                visualizationSteps.push({ type: 'final', node: current });
            }

            return { distances, previousNodes };
        }

        // ------------------ UI ë° ì‹¤í–‰ ------------------

        /**
         * ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ UIì— ë Œë”ë§
         */
        function runSimulationUI() {
            if (isVisualizing) return;
            isVisualizing = true;
            runButton.disabled = true;
            runButton.textContent = 'íƒìƒ‰ ì¤‘... ğŸš€';

            const startRouter = startRouterSelect.value;
            if (!startRouter) {
                logOutput.innerHTML = "ì¶œë°œ ì¹œêµ¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
                tableOutput.innerHTML = "";
                runButton.disabled = false;
                runButton.textContent = 'ìµœë‹¨ ë…¸ë ¥ ê²½ë¡œ íƒìƒ‰';
                isVisualizing = false;
                return;
            }

            // 1. UI ì…ë ¥ê°’ì„ ì½ì–´ í˜„ì¬ ê·¸ë˜í”„ êµ¬ì„±
            currentGraph = getCustomGraph();

            // 2. ë„¤íŠ¸ì›Œí¬ ì´ˆê¸°í™” ë° ê·¸ë¦¬ê¸° (ìƒˆ ê·¸ë˜í”„ ë°˜ì˜)
            drawNetwork(currentGraph);

            // 3. ë‹¤ìµìŠ¤íŠ¸ë¼ ì‹¤í–‰ ë° ì‹œê°í™” ë‹¨ê³„ ê¸°ë¡
            const { distances, previousNodes } = dijkstraShortestPath(currentGraph, startRouter);
            
            // 4. ì‹œê°í™” ì‹œì‘
            visualizeSteps(visualizationSteps, previousNodes);
            
            // 5. ìµœì¢… í…Œì´ë¸” ë Œë”ë§ (ì‹œê°í™” ì™„ë£Œ í›„ í‘œì‹œ)
            setTimeout(() => renderRoutingTable(distances, previousNodes, startRouter), visualizationSteps.length * STEP_DELAY + 100);
        }

        /**
         * ìµœì¢… ë¼ìš°íŒ… í…Œì´ë¸”ì„ HTMLë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderRoutingTable(distances, previousNodes, startRouter) {
            let tableHtml = `
                <p class="mb-3 text-sm text-gray-600">
                    ë‹¹ì‹ (ì¹œêµ¬ **${startRouter}**)ì´ ëª¨ë“  ì¹œêµ¬ì—ê²Œ ìµœì†Œí•œì˜ ë…¸ë ¥ìœ¼ë¡œ ì—°ê²°ë˜ê¸° ìœ„í•´ í•„ìš”í•œ ì´ ë…¸ë ¥ê³¼ ê²½ë¡œì…ë‹ˆë‹¤.
                </p>
                <table class="min-w-full divide-y divide-gray-300 rounded-xl overflow-hidden shadow-lg">
                    <thead class="bg-indigo-600 text-white">
                        <tr>
                            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">ëª©ì ì§€ ì¹œêµ¬</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">ìµœì†Œ ëˆ„ì  ë…¸ë ¥</th>
                            <th class="px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">ê°€ì¥ ì¢‹ì€ ê´€ê³„ ê²½ë¡œ</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            const sortedNodes = Object.keys(distances).sort();

            sortedNodes.forEach((targetNode, index) => {
                if (targetNode === startRouter) return;
                
                const finalDistance = distances[targetNode];
                const path = reconstructPath(previousNodes, startRouter, targetNode);
                const distanceText = finalDistance === Infinity ? 'ì—°ê²° ë¶ˆê°€ëŠ¥' : finalDistance;
                const pathText = path === "ê²½ë¡œ ì—†ìŒ" ? 'ì´ ì¹œêµ¬ì™€ëŠ” ì—°ê²°í•  ìˆ˜ ì—†ì–´ìš” ğŸ˜¢' : path;

                const rowColor = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';

                tableHtml += `
                    <tr class="${rowColor} hover:bg-indigo-100 transition duration-150">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${targetNode}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-bold">${distanceText}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 code-output">${pathText}</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;
            
            tableOutput.innerHTML = tableHtml;
        }

        /**
         * ë„¤íŠ¸ì›Œí¬ ì§€ë„ë¥¼ UIì— ë Œë”ë§í•©ë‹ˆë‹¤. (ê°€ì¤‘ì¹˜ ì…ë ¥ í•„ë“œ í¬í•¨)
         */
        function renderNetworkMap() {
            let mapHtml = '';
            
            INITIAL_LINKS.forEach(link => {
                // ì…ë ¥ í•„ë“œ IDëŠ” ì •ë ¬ëœ ë…¸ë“œ ì´ë¦„ìœ¼ë¡œ í†µì¼ (ì¤‘ë³µ ë°©ì§€)
                const [u, v] = [link.u, link.v].sort();
                const inputId = getElementId('input', u, v);

                mapHtml += `
                    <div class="flex items-center space-x-2 text-sm font-semibold text-gray-800">
                        <span class="text-red-600 whitespace-nowrap">${link.u} â†” ${link.v}</span>: 
                        <input type="number" id="${inputId}" value="${link.cost}" min="1" max="999" class="weight-input" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                        <span class="text-xs text-gray-500">ë…¸ë ¥</span>
                    </div>
                `;
            });
            networkMap.innerHTML = mapHtml;
        }

        /**
         * ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
         */
        function init() {
            const nodes = Object.keys(NODE_POSITIONS).sort();
            startRouterSelect.innerHTML = nodes.map(node => 
                `<option value="${node}">ì¹œêµ¬ ${node}</option>`
            ).join('');
            
            renderNetworkMap(); 
            
            // Aë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„ íƒ í›„ ì‹œë®¬ë ˆì´ì…˜ ìë™ ì‹¤í–‰
            startRouterSelect.value = 'A';
            runSimulationUI();
        }

        window.onload = init;
    </script>
</body>
</html>
